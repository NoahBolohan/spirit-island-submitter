<!-- Inspired by https://stackoverflow.com/questions/70767778/html-form-submission-to-google-sheets-using-apps-scripts-landing-thank-you-pag -->
<script>
	function on_load() {
		/*
		Stuff to do on app load.
		*/
		player_inputs(1);
	}

	var createElement = function(type, props) {
		/*
		Create an element of given type and props.
		*/
		var $e = document.createElement(type);

		for (var prop in props) {
			$e.setAttribute(prop, props[prop]);
		}

		return $e;
	}

	function player_inputs(value) {
		/*
		Create input and select elements for the appropriate number of players.
		*/
		var names_element = document.getElementById("div_player_names");
		var spirits_element = document.getElementById("div_player_spirits");

		var spirits = [
			"Lightning's Swift Strike",
			"River Surges in Sunlight",
			"Shadows Flicker Like Flame",
			"Vital Strength of Earth",
		];
		
		var count = parseInt(value) ;
		var input_idx = 1;

		names_element.innerHTML = "";
		spirits_element.innerHTML = "";

		while (input_idx <= count) {
			// Create name input for player ${input_idx}
			names_element.appendChild(
				createElement("input", {name : `player_${input_idx}_name`, type : `player_${input_idx}_name`, placeholder : `Player ${input_idx} name`})
			);

			// Create spirit select for player ${input_idx}
			spirits_element.appendChild(
				createElement("select", {name : `player_${input_idx}_spirit`, id : `player_${input_idx}_spirit`})
			);
			
			// Populate the spirit select element
			spirits_select_element = document.getElementById(`player_${input_idx}_spirit`);

			spirits_select_element.options[0] = new Option(`Select player ${input_idx}'s spirit`, spirits_select_element.options.length);

			for(index in spirits) {
				spirits_select_element.options[spirits_select_element.options.length] = new Option(spirits[index], spirits[index]);
			}
			
			input_idx += 1;
		}
	}
</script>
<script>
	window.addEventListener("load", function() {
		const form = document.getElementById('googleform');
		form.addEventListener("submit", function(e) {
			e.preventDefault();
			const data = new FormData(form);
			const action = e.target.action;
			fetch(action, {
			method: 'POST',
			body: data,
			});
			})
		});
		});
</script>

<body onload = "on_load()">

	<form class="googleform" name="googleform" id="googleform" target="_top" method="POST" onsubmit="myFunction()" action="https://script.google.com/macros/s/AKfycbwSzW7MqEhMF3dpm_aGV2f-aUxKKb8j1888YBMjDIlCqbLRyao4mElFqDAfcebIXnTi/exec">

	<div id="div_n_players">
        <p>Number of players:
		<select id="n_players" name="n_players" onchange="player_inputs(this.value)">
			<option selected="">1</option>
			<option>2</option>
			<option>3</option>
			<option>4</option>
		</select></p>
	</div>

	Player info:

	<div id="div_player_names"></div>

	<div id="div_player_spirits"></div>

    <button type="submit" class="btn-default btn" name="submit" access="false" style="default" id="submit">Submit</button>
</form>

</body>